---
title: "Recours"
author: "Clémence Bracq"
date: "2023-10-23"
output:
  html_notebook: 
    encoding: UTF-8
  pdf_document: default
  html_document:
    df_print: paged
    encoding: UTF-8
editor_options:
  markdown:
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}
source("Libraries.R")
```

```{r base, include=FALSE}
if (!exists("indiv")) {
    indiv <- read_sas("X:/HAB-TEO2-exploitations/MàJ Insee avril 2023/indiv.sas7bdat",  catalog_file = "X:/HAB-TEO2-exploitations/MàJ Insee avril 2023/formats.sas7bcat")
indiv <- to_factor(indiv)
}
```

```{r, include = FALSE}
indiv_petite <- indiv %>% select(s_medeciq_a, s_medeciq_b, s_medeciq_c, s_medeciq_d, s_medeciq_f, s_medeciq_nbval, s_medeciq_flag, s_renonc, s_queren_a, s_queren_b, s_queren_c, s_queren_d, s_queren_e, s_queren_f, s_queren_flag, s_queren_g, s_queren_h, s_queren_nbval, s_pqren_a, s_pqren_b, s_pqren_c, s_pqren_d, s_pqren_e, s_pqren_f, s_pqren_g, s_pqren_h, s_pqren_i, s_pqren_nbval, s_pqren_flag, s_refus, s_frott, s_etat, s_maladi, s_limite, s_ald, s_deprim, s_noplais, sexee, csnq_ego, csnq_premp, etre, originegeo, s_ame, s_secuq, agenq, group1)
```

# Recours aux soins {.tabset .tabset-fade}

## Indicateurs {.tabset .tabset-fade}

### Indicateurs généraux : {.tabset .tabset-fade}

-   Renoncement aux soins (**s_renonc**),

-   Renoncement à aller voir un généraliste (**s_queren_gen**)

```{r}
indiv<- indiv %>% 
  mutate(s_renonc_gen = ifelse(s_queren_a == "Modalité citée", "A renoncé à aller voir un généraliste","N'a pas renoncé à aller voir un généraliste"))

```

-   Refus de soins, discrimination du fait d'AME/PUMA (**s_refus**)

-   Pas de recours dans l'année à un médecin (toutes spécialités),
    psychologue ou dentiste (**s_medeciq_g**)

```{r pas_recours}
indiv <- indiv %>% 
  mutate(s_medeciq_g = case_when(s_medeciq_flag == "A répondu" ~  ifelse(s_medeciq_a == "Modalité non citée" & s_medeciq_b == "Modalité non citée" & s_medeciq_c == "Modalité non citée" & s_medeciq_d == "Modalité non citée" & s_medeciq_e == "Modalité non citée" & s_medeciq_f == "Modalité non citée", "Modalité citée", "Modalité non citée"),
                                 TRUE ~ s_medeciq_flag))
```

-   Pas de recours alors que mauvaise santé déclarée = ressenti
    (**pas_recours_etat**)

```{r}
indiv <- indiv %>% 
  mutate(pas_recours_etat = case_when(
    (s_etat == "Moyen"|s_etat=="Mauvais"| s_etat == "Très mauvais")&
      (s_medeciq_g=="Modalité citée")~ "Pas de recours alors que mauvaise santé déclarée",
    (s_etat == "Moyen"|s_etat=="Mauvais"| s_etat == "Très mauvais")&
      (s_medeciq_g=="Modalité non citée")~ "Recours et mauvaise santé déclarée", 
    TRUE ~ NA))

```

-   Pas de recours alors que ALD, limitations ou maladies chroniques =
    factuel (**pas_recours_ald**)

```{r}
indiv <- indiv %>% 
  mutate(pas_recours_ald = case_when(santé moyen, mauvais
    (s_maladi == "Oui"| s_limite == "Oui"| s_ald == "Oui")&
      (s_medeciq_g=="Modalité citée")~ "Pas de recours alors que ALD/limites/maladies chroniques",
    (s_maladi == "Oui"| s_limite == "Oui"| s_ald == "Oui")&
      (s_medeciq_g=="Modalité non citée")~ "Recours et ALD/limites/maladies chroniques", 
    TRUE ~ NA))
```

### Indicateurs spécifiques : {.tabset .tabset-fade}

-   Pour les femmes après 25 ans, pas de frottis dans les 3 ans
    (**frott_ap_25**)

```{r}
indiv <- indiv %>% 
  mutate(frott_ap_25 = case_when(
    agenq >= 25 & s_frott =="Non" & sexee == "Féminin"~ "Pas de frottis", 
    agenq >= 25 & s_frott =="Oui" & sexee == "Féminin"~ "Frottis", 
    TRUE ~ NA))
```

-   Dépression et pas de recours à un psy (**nonrecours_psy**)

```{r}
indiv <- indiv %>% 
  mutate(nonrecours_psy = case_when(
    (s_deprim == "Oui"|s_noplais == "Oui") & s_medeciq_e == "Modalité non citée" ~ "Dépression et pas de recours à un psy", 
    (s_deprim == "Oui"|s_noplais == "Oui") & s_medeciq_e == "Modalité citée" ~ "Dépression et recours à un psy", 
    TRUE ~ NA))
```

## Statistiques descriptives et graphiques {.tabset .tabset-fade}

```{r bases_pd, include=FALSE}
indiv$group1_rec <- indiv$group1 %>%
  fct_recode(
    "Immigré" = "Immigré (né étranger à l'étranger y compris réintégrés)",
    "DROM" = "Originaire de l'Outre-mer",
    "G2 immigré" = "Descendant G2 d'un ou deux immigré-s",
    "G2 DROM" = "Descendant G2 d'un ou deux originaire-s de l'Outre-mer",
    "Autre" = "Population non immigrée ni originaire d'Outre-mer et descendant de deux parents non immigrés et non originaires d'Outre-mer"
  )
# if (!exists("indiv_pd")) {
indiv_pd <- svydesign(ids = indiv$ident_fa, data = indiv, weights = indiv$poidsi)
  
```

### Tableau général

Les indicateurs qui paraissent significativement corrélée au rapport à
la migration sont : le renoncement à des soins, le fait de n'avoir
recours à aucun soin, le fait de ne pas avoir eu de frottis, et le fait
d'avoir connu un épisode dépressif sans recourir à un psy.

```{r, results='asis', echo=FALSE}

tb <- indiv_pd %>% tbl_svysummary(by = group1_rec, percent = "column",
  include = c(s_renonc, s_renonc_gen, s_refus, s_medeciq_g, pas_recours_etat, pas_recours_ald, frott_ap_25, nonrecours_psy)) %>%
  add_overall(last = TRUE) %>%
  add_p()

tb[is.na(tb)] <- ""
knitr::kable(tb, format = "html", mssing="NA")
#Si utilisation hors markdown juste sortir tb dans la console
```

### Indicateurs généraux {.tabset .tabset-fade}

#### Renoncement aux soins (notamment parce que trop loin)

```{r, echo = FALSE}
cprop(svytable(~ s_renonc + group1_rec, indiv_pd))
```

13.8% des enquêté.e.s déclarent avoir renoncé à des soins. Les immigrés
sont la population à avoir le moins renoncé au soins (11.3%) par rapport
à leurs descendants (14.3%), aux originaires des DOM_TOM (16.2%), à
leurs descendants (13.4%) et au reste de la population (14.2%).

```{r, include = FALSE}
prop.table(svytable(~s_pqren_nbval, indiv_pd))
prop.table(svytable(~s_pqren_a, indiv_pd))
svytable(~s_pqren_nbval, indiv_pd)

```

La plupart des personnes n'ont indiqué qu'une seule raison à ce
renoncement :

-   51 % le coût

-   14 % attente que ça passe

-   2 % pas savoir qui aller voir

-   0.8 % langue

-   0.7% papiers

-   9% peur des soins

-   21% pas le temps

-   6% trop loin ou trop compliqué

-   19% autre

```{r, include=  FALSE}
indiv_renonc_immig <- indiv %>% filter(s_renonc == "Oui") %>% filter(group1 == "Immigré (né étranger à l'étranger y compris réintégrés)")
indiv_renonc_immig_pd <- svydesign(ids = indiv_renonc_immig$ident_fa, data = indiv_renonc_immig, weights = indiv_renonc_immig$poidsi)
prop.table(svytable(~s_pqren_nbval, indiv_renonc_immig_pd))
prop.table(svytable(~s_pqren_i, indiv_renonc_immig_pd))

indiv_renonc_nonimmig <- indiv %>% filter(s_renonc == "Oui") %>% filter(group1 != "Immigré (né étranger à l'étranger y compris réintégrés)")
indiv_renonc_nonimmig_pd <- svydesign(ids = indiv_renonc_nonimmig$ident_fa, data = indiv_renonc_nonimmig, weights = indiv_renonc_nonimmig$poidsi)
prop.table(svytable(~s_pqren_nbval, indiv_renonc_nonimmig_pd))
prop.table(svytable(~s_pqren_i, indiv_renonc_nonimmig_pd))




```

Les immigrés ont coché moins de raisons que la totalité de
l'échantillon. Les modalités cochées davatage par les immigrés que par
le reste de la population sont les papiers (1.4% chez les immigrés,
0.66% dans le reste de la population), le manque de temps (24.6% contre
20.8%), et l'accessibilité (7% contre 5.3%).

```{r, include = FALSE}
indiv_renonc <- indiv %>% filter(s_renonc == "Oui")
indiv_renonc_pd <- svydesign(ids = indiv_renonc$ident_fa, data = indiv_renonc, weights = indiv_renonc$poidsi)

prop.table(svytable(~s_queren_nbval, indiv_renonc_pd))
prop.table(svytable(~s_queren_h, indiv_renonc_pd))

```

Ici aussi la plupart des personnes n'ont indiqué qu'un seul type de
renoncement :

-   17.6% un généraliste

-   52.1% autre pro de santé

-   26.2% soins dentaires importants

-   7.6% médicaments

-   9.6% lunettes

-   7.5% analyses

-   9.2% imagerie

-   10.1% autre

```{r, include = FALSE}
prop.table(svytable(~s_queren_h, indiv_renonc_immig_pd))
```

Parmi les personnes ayant renoncé a un soin, les immigrés ont davantage
renoncé à voir un généraliste que d'autres professionnels de santé
(21.7% contre 17.6% dans toute la population), et moins souvent à des
spécialistes ou aux analyses qui en découlent (46.1% contre 52.1% pour
les spécialistes, 22.2% contre 26.1% pour les soins dentaires, 5.4%
contre 7.5% pour les analyses).

On peut donc supposer que le taux de renoncement est moins élevé chez
les immigrés du fait d'une forme d'autocensure pour les soins non
primaires.

On souhaiterait donc savoir si les immigrés ont plus ou moins renoncé à
aller voir un généraliste que le reste de la population (non parmi les
personnes ayant renoncé à des soins mais en général).

```{r, echo = FALSE}
cprop(svytable(~ s_renonc_gen + group1_rec, indiv_pd))
```

Les immigrés sont effectivement la population qui a le plus renoncé à
voir un généraliste.

```{r, echo= FALSE}
  a <- prop.table(svytable(~s_queren_a, indiv_renonc_pd))
  b <- prop.table(svytable(~s_queren_b, indiv_renonc_pd))
  c <- prop.table(svytable(~s_queren_c, indiv_renonc_pd))
  d <- prop.table(svytable(~s_queren_d, indiv_renonc_pd))
  e <- prop.table(svytable(~s_queren_e, indiv_renonc_pd))
  f <- prop.table(svytable(~s_queren_f, indiv_renonc_pd))  
  g <- prop.table(svytable(~s_queren_g, indiv_renonc_pd))  
  h <- prop.table(svytable(~s_queren_h, indiv_renonc_pd)) 
  # nb <- svymean(~s_queren_nbval, indiv_renonc_pd)
ensemble <- c(as.numeric(a[2]), as.numeric(b[2]), as.numeric(c[2]), as.numeric(d[2]), as.numeric(e[2]), as.numeric(f[2]), as.numeric(g[2]), as.numeric(h[2])
              # , nb
              )

type_renonc_raison<- function(var){
  indiv_renonc_new <- indiv_renonc %>% filter(var == "Modalité citée")
  indiv_renonc_new_pd <- svydesign(ids = indiv_renonc_new$ident_fa, data = indiv_renonc_new, weights = indiv_renonc_new$poidsi)
  a <- prop.table(svytable(~s_queren_a, indiv_renonc_new_pd))
  b <- prop.table(svytable(~s_queren_b, indiv_renonc_new_pd))
  c <- prop.table(svytable(~s_queren_c, indiv_renonc_new_pd))
  d <- prop.table(svytable(~s_queren_d, indiv_renonc_new_pd))
  e <- prop.table(svytable(~s_queren_e, indiv_renonc_new_pd))
  f <- prop.table(svytable(~s_queren_f, indiv_renonc_new_pd))  
  g <- prop.table(svytable(~s_queren_g, indiv_renonc_new_pd))  
  h <- prop.table(svytable(~s_queren_h, indiv_renonc_new_pd)) 
#  nb <- mean(~s_queren_nbval, indiv_renonc_new_pd)
  v <- c(as.numeric(a[2]), as.numeric(b[2]), as.numeric(c[2]), as.numeric(d[2]), as.numeric(e[2]), as.numeric(f[2]), as.numeric(g[2]), as.numeric(h[2])
         # , nb
         )
  return(v)
}

cout <- type_renonc_raison(indiv_renonc$s_pqren_a)
attente <- type_renonc_raison(indiv_renonc$s_pqren_b)
qui <- type_renonc_raison(indiv_renonc$s_pqren_c)
langue <- type_renonc_raison(indiv_renonc$s_pqren_d)
papiers <- type_renonc_raison(indiv_renonc$s_pqren_e)
peur <- type_renonc_raison(indiv_renonc$s_pqren_f)
temps <- type_renonc_raison(indiv_renonc$s_pqren_g)
loin <- type_renonc_raison(indiv_renonc$s_pqren_h)
autre <- type_renonc_raison(indiv_renonc$s_pqren_i)


tab = data.frame(ensemble, cout,attente, qui, langue, papiers, peur, temps, loin, autre)
tab
```

Les motifs pas le temps et trop loin sont souvent surreprésentés pour
les mêmes soins, ce qui nous fait supposer qu'ils sont difficilement
différentiables (un soin loin prend plus de temps). Ces deux motifs sont
surreprésentés pour le généraliste, les autres spécialités et les
analyses, qui sont également des soins auxquels les immigrés renoncent
plus souvent que le reste de la population. Concernant les soins
dentaires, le motif principal de renoncement est le coût.

```{r, include = FALSE}
rm(indiv_renonc_immig, indiv_renonc_immig_pd, indiv_renonc_nonimmig, indiv_renonc_nonimmig_pd, indiv_renonc, indiv_renonc_pd)
gc()
```

#### Refus de soins, discrimination

```{r, echo = FALSE}
indiv_ref <- indiv%>% filter(indiv_petite$s_secuq == "La protection universelle maladie (PUMA, autrefois appelée CMU)" | indiv_petite$s_secuq == "L'aide médicale d'État (AME)"| indiv_petite$s_ame == "L'aide médicale d'État (AME)")
indiv_ref_pd <- svydesign(ids = indiv_ref$ident_fa, data = indiv_ref, weights = indiv_ref$poidsi)
prop.table(svytable(~s_refus, indiv_ref_pd))
cprop(svytable(~s_refus + group1_rec, indiv_ref_pd))

```

9.5% des personnes bénéficiant de la PUMA ou de l'AME ou ayant bénéficié
de l'AME se sont déjà vus refuser une consultation médicale de ce fait.
Cependant, les immigrés comme les personnes originaires des DROM
déclarent moins souvent avoir subi un refus. Ce résultat est peut-être
également dû à un sentiment de moindre légitimité et donc à une moindre
identification de ce refus comme une discrimination.

#### Pas de recours dans l'année, par exemple à un généraliste (notamment si ALD ou mauvaise santé déclarée)

s_medeciq_g = Pas de recours à aucun pro

```{r, echo = FALSE}
cprop(svytable(~s_medeciq_g+group1_rec, indiv_pd))
```

Les immigrés, domiens et leurs descendants déclarent plus souvent
n'avoir eu recours à aucun des soins proposés.

```{r, echo = FALSE}
cprop(svytable(~s_etat+group1_rec, indiv_pd))

```

Les immigrés sont ceux qui se déclarent en moins bonne santé.

```{r, echo = FALSE}

cprop(svytable(~pas_recours_etat+group1_rec, indiv_pd))

```

```{r}

cprop(svytable(~pas_recours_ald+group1, indiv_pd))


```

### Indicateurs spécifiques : {.tabset .tabset-fade}

#### Frottis dans les 3 années précédentes

```{r}

cprop(svytable(~frott_ap_25 +group1, indiv_pd))


```

Les femmes immigrées de plus de 25 ans n'ont pas eu de frottis dans les
3 dernières années plus souvent que les autres (24.2% contre 16.4% de la
population non immigrée ni DROM ni descendants)

#### Dépression et pas de recours à un psy

```{r}
cprop(svytable(~s_noplais+group1, indiv_pd))

```

Moins de dépression chez les immigrés, plus chez les personnes ni
immigré ni DROM ni descendants

```{r}

cprop(svytable(~nonrecours_psy+group1, indiv_pd))

```

Parmi les personnes ayant connu une période de dépression, les personnes
immigrées ou originaires des DROM ont moins souvent recours à un
psychologue ou un psychiatre.

```{r, include =FALSE}
# indiv_mca <- indiv %>% select(s_refus, s_renonc, pas_recours_etat, pas_recours_ald, frott_ap_25, sexee, group1, csnq_ego, csnq_premp, etre, originegeo, s_ame, s_secuq, agenq)
# res <- MCA(indiv_mca, quali.sup = 5:13, quanti.sup = 14)
# HCPCshiny(res)
# 
# 
# 
# indiv_num <- indiv %>% 
#   select(s_refus, s_renonc, pas_recours_etat, pas_recours_ald, frott_ap_25, sexee, group1) %>% 
#   mutate(s_refus_num = ifelse(s_refus=="Oui", 1, 0),
#          s_renonc_num = ifelse(s_renonc=="Oui", 1, 0),
#          pas_recours_etat_num = ifelse(pas_recours_etat=="Oui", 1, 0),
#         pas_recours_ald_num = ifelse(pas_recours_ald=="Oui", 1, 0),
#         frott_ap_25_num = ifelse(frott_ap_25=="Pas de frottis pour femme de plus de 25 ans", 1, 0),
#         sexee_num = ifelse(sexee =="Féminin", 1, 0),
#         group1_num = ifelse(group1=="Immigré (né étranger à l'étranger y compris réintégrés)", 1, 0)) %>% 
#   select(s_refus_num, s_renonc_num, pas_recours_etat_num, pas_recours_ald_num, frott_ap_25_num, sexee_num, group1_num)
# indiv_num[is.na(indiv_num)] <- 0
# 
# 
# library(corrplot)
# M <- cor(indiv_num)
# corrplot(M)
```
